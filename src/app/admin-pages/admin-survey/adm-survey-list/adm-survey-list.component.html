<h1 class="px-5 py-4 m-0 fw-bold" style="font-size: 24pt">Survey</h1>

<div class="container px-5">
  <div class="card">
    <div class="card-header bg-white p-4">
      <h5 class="m-0" style="font-size: 16pt">Survey List</h5>
    </div>
    <div class="card-body d-flex justify-content-center">

      <!-- CONTENT -->
      <div class="col-lg-12 grid-margin stretch-card ">
        <div class="row mb-3">
          <div class="col-12">
            <div class="col-md-3 ms-auto">
              <div class="input-group rounded align-self-end">
                <form [formGroup] = "formSearch" >
                  <div class="input-group mb-3">
                    <input formControlName="search" type="search" class="form-control rounded justify-content-center" placeholder="Search by NIK/ Name" aria-label="Search" aria-describedby="search-addon"
                    />
                    <span style="vertical-align: bottom" alt="show" class="input-group-text" (click)="searching()"><i class="fas fa-search"></i></span>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="table table-responsive" style="width:100%">
            <table class="table">
              <thead *ngIf="!isLoading; else loading" class="thead-dark">
                  <tr>
                      <th scope="col">#</th>
                      <th scope="col">Identity Number</th>
                      <th scope="col">Name</th>
                      <th scope="col">Transaction ID</th>
                      <th scope="col">Transaction Date</th>
                      <th scope="col">Transaction Status</th>
                      <th scope="col">Survey Status</th>
                      <th scope="col">Action</th>
                  </tr>
              </thead>
              <div *ngIf="!hasData()">No Data Found</div>
              <tbody *ngIf="hasData()" >
                <tr *ngFor="let transaction of listCustomerTransaction | paginate:{itemsPerPage: paginate?.size, currentPage: currentPaginate['page'], totalItems: paginate?.totalElements}; let i = index">
                  <th style="vertical-align: bottom">{{(currentPaginate['page'] - 1) * paginate?.size! + (i + 1)}}</th>
                  <td style="vertical-align: bottom">{{transaction.customerId.nik}}</td>
                  <td style="vertical-align: bottom">{{transaction.customerId.fullName}}</td>
                  <td style="vertical-align: bottom">{{transaction.trxId}}</td>
                  <td style="vertical-align: bottom">{{transaction.trxDate | date: 'dd/MM/yyyy'}}</td>
                  <td style="vertical-align: bottom">{{transaction.trxStatus}}</td>
                  <td style="vertical-align: bottom; align-content: center;">
                      <span class ="dot" [ngClass]="{
                        'dot-red' : transaction.isSurvey == false,
                        'dot-green' : transaction.isSurvey == true}">
                      </span>
                      {{transaction.isSurvey | trueFalse}}
                  </td>
                  <td>
                    <div ngbDropdown class="d-inline-block">
                    <button class="btn btn-outline-primary" [disabled]="transaction.trxStatus === 'APPROVED'" id="dropdownMenu1" ngbDropdownToggle>Details</button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenu1" ngbDropdownMenu>
                        <button class="dropdown-item" (click)="fillSurvey(transaction.customerId.nik, transaction.trxId)">Fill Survey</button>
                        <button class="dropdown-item" (click)="detailsSurvey(transaction.customerId.nik,transaction.trxId)">Details Survey</button>
                        <button class="dropdown-item" [disabled]="transaction.isSurvey === false" (click)="deleteSurvey(transaction.trxId)">Delete Survey</button>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <ng-template #loading>
        <div class="spinner-border spinner-border-sm" role="status">
            <span class="sr-only"></span>
        </div>
      </ng-template>
      </div>
      <!-- END OF CONTENT -->

    </div>
    <div class="d-flex justify-content-center">
      <pagination-controls (pageChange)="pageChanged($event)"
          previousLabel="Previous" nextLabel="Next" >
      </pagination-controls>
    </div>
</div>
